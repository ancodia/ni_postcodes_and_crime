---
title: "NI Postcode and Crime Data"
author: "Danny Regan"
output:
  pdf_document: 
    fig_caption: true
  html_document:
    keep_md: true
---
```{r, include=FALSE}
source("ni_postcodes_data.R")
source("ni_crime_data.R")
```

This document describes the methods used during and results obtained from preparation an analysis of postcode and crime data for Northern Ireland. The postcode dataset is the focus of the first section, while the following section features the steps taken in analysing the crime dataset. 

All code referenced in this document can be found on Github[^1]. All related data files are contained in a `data` folder in the project working directory.

[^1]: https://github.com/ancodia/ni_postcodes_and_crime

# NI Postcode Data
a\) The first step is to load the NI postcodes dataset as a dataframe. The `describe_data()` function is then used to display the total number of records in the newly created dataframe, then shows the structure of the data and prints the first 10 rows.
```{r}
ni_postcodes <- read.csv("data/NIPostcodes.csv")
describe_data(ni_postcodes)
```
\noindent\makebox[\linewidth]{\rule{\textwidth}{0.4pt}}

b\) The correct titles are then assigned to each column in the postcodes dataframe.
```{r}
ni_postcodes <- rename_columns(ni_postcodes)
```
\noindent\makebox[\linewidth]{\rule{\textwidth}{0.4pt}}

\newpage
c\) Next comes the handling of missing data.

From visually inspecting the dataframe, there are a lot of empty cells. Replacing these with NA to get a clearer idea of what is missing
```{r}
ni_postcodes[ni_postcodes == ""] <- NA
```

VIM is used to get missing values and then print a summary of what is not there.
```{r}
missing_values <- aggr(ni_postcodes, 
                       prop = FALSE, 
                       numbers = TRUE, 
                       plot = FALSE)

missing_values[["missings"]]
```
Missing values of note are Town (19872) and Postcode (8900)

Rows with either Town or Postcode missing will be removed because ambiquity is introduced if a record has either of these not present.
```{r}
ni_postcodes <- ni_postcodes[!(is.na(ni_postcodes$Town) | 
                                 is.na(ni_postcodes$Postcode)),]
```
\noindent\makebox[\linewidth]{\rule{\textwidth}{0.4pt}}

\newpage
d\) After ignoring rows with a missing town or postcode value, the missing value counts for the dataframe is as follows:
```{r}
missing_values_after_removal <- aggr(ni_postcodes, 
                                     prop = FALSE, 
                                     numbers = TRUE, 
                                     plot = FALSE)

missing_values_after_removal[["missings"]]
```

Rows with NA for Town or Postcode are removed.

Total rows after cleaning:
```{r}
nrow(ni_postcodes)
```
\noindent\makebox[\linewidth]{\rule{\textwidth}{0.4pt}}

e\) The primary key column is to be moved from the last position in the dataframe to the first with the `move_primary_key()` function. The before and after order of columns is displayed below.
```{r}
ni_postcodes <- move_primary_key(ni_postcodes)
```
\noindent\makebox[\linewidth]{\rule{\textwidth}{0.4pt}}

f\) A dataframe is then created containing only postcode records where the locality, townland or town contains Limavady. In the `extract_limavady_data()` function used to achieve this, the number of rows in the new dataframe is displayed and then the data is written to a csv file.
```{r}
limavady_data <- extract_limavady_data(ni_postcodes)
```

```{r fig.align = 'center', out.width = "80%", fig.cap = "limavady.csv", echo = FALSE}
knitr::include_graphics(here::here("images", "limavady.png"))
```

\noindent\makebox[\linewidth]{\rule{\textwidth}{0.4pt}}

\newpage
g\) Finally, the cleaned NI postcode dataframe is written to a csv file, ready for analysis.
```{r}
write.csv(ni_postcodes, "data/CleanNIPostcodeData.csv")
```

```{r fig.align = 'center', out.width = "80%", fig.cap = "CleanNIPostcodeData.csv", echo = FALSE}
knitr::include_graphics(here::here("images", "cleaned_postcodes.png"))
```

\noindent\makebox[\linewidth]{\rule{\textwidth}{0.4pt}}

# NI Crime Data
a\) In the `combine_crime_data()` function all data from the monthly crime report files are combined into a single dataframe, this dataframe is written to the AllNICrimeData.csv file (see below) and the total number of records is printed.
```{r, warning = FALSE}
crime_data <- combine_crime_data("data/NI Crime Data/")
```

```{r fig.align = 'center', out.width = "80%", fig.cap = "Initial AllNICrimeData.csv", echo = FALSE}
knitr::include_graphics(here::here("images", "all_crime.png"))
```
\noindent\makebox[\linewidth]{\rule{\textwidth}{0.4pt}}

b\)
```{r}

```
```{r fig.align = 'center', out.width = "80%", fig.cap = "Modified AllNICrimeData.csv", echo = FALSE}
knitr::include_graphics(here::here("images", "all_crime2.png"))
```
\noindent\makebox[\linewidth]{\rule{\textwidth}{0.4pt}}

c\)
```{r}

```

d\)
```{r}

```

e\)
```{r}

```

f\)
```{r}

```

g\)
```{r}

```

h\)
```{r}

```

i\)
```{r}

```

i\)
```{r}

```

i\)
```{r}

```